_tag)
                    import base64
                    ss_credential = f"{SS_METHOD}:{new_key_uuid}"
                    ss_encoded = base64.b64encode(ss_credential.encode()).decode()
                    vpn_link = f"ss://{ss_encoded}@{SS_SERVER}:{SS_PORT}#{key_tag}"
                    
                elif protocol == 'tuic':
                    from src.bot.config_manager import add_tuic_user
                    add_tuic_user(new_key_uuid, key_tag)
                    vpn_link = f"tuic://{new_key_uuid}:{new_key_uuid}@{SERVER_IP}:{TUIC_PORT}?congestion_control=bbr&alpn=h3&sni=www.microsoft.com&allow_insecure=1#{key_tag}"

                elif protocol == 'vlessplain':
                    from src.bot.config_manager import add_vless_plain_user
                    add_vless_plain_user(new_key_uuid, key_tag)
                    vpn_link = f"vless://{new_key_uuid}@{SERVER_IP}:{VLESS_PLAIN_PORT}?security=tls&encryption=none&type=tcp&sni=www.microsoft.com&allowInsecure=1#{key_tag}"
                
                elif protocol == 'ss_legacy':
                     # No config update needed for legacy shared password
                     import base64
                     ss_credential = f"{SS_METHOD}:{SS_LEGACY_PASSWORD}"
                     ss_encoded = base64.b64encode(ss_credential.encode()).decode()
                     vpn_link = f"ss://{ss_encoded}@{SS_SERVER}:{SS_LEGACY_PORT}#{key_tag}"

                else:
                     raise HTTPException(status_code=400, detail="Invalid protocol")

                # Save the VPN key to vpn_keys table for retrieval
                try:
                    from datetime import datetime, timedelta
                    expires_at = (datetime.now() + timedelta(days=30)).isoformat()
                    
                    print(f"[KEYS_DEBUG] Attempting to save key to vpn_keys table...")
                    print(f"[KEYS_DEBUG] user_uuid={uuid}, key_name={key_tag}, protocol={protocol}")
                    
                    conn = get_db_connection()
                    cursor = conn.cursor()
                    cursor.execute("""
                        INSERT INTO vpn_keys (user_uuid, key_name, protocol, server_address, server_port,
                                              key_uuid, key_password, config_link, expires_at)
                        VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
                    """, (uuid, key_tag, protocol, SERVER_IP, 
                          SERVER_PORT if protocol in ['vless', 'tuic'] else (LIMITED_PORT if protocol == 'vless_limited' else (SS_PORT if protocol in ['ss'] else VLESS_PLAIN_PORT)),
                          new_key_uuid, new_key_uuid if protocol in ['tuic'] else None, 
                          vpn_link, expires_at))
                    conn.commit()
                    conn.close()
                    print(f"[KEYS_DEBUG] ✅ Key saved to vpn_keys table successfully!")
                except Exception as db_error:
                    print(f"[KEYS_DEBUG] ❌ Failed to save to vpn_keys table: {db_error}")
                    import traceback
                    traceback.print_exc()

                return {
                    "success": True,
                    "message": "Payment Verified!",
                    "key": vpn_link,
                    "protocol": protocol,
                    "transaction_id": data['transaction_id']
                }

            except Exception as e:
                print(f"Config update failed: {e}")
                raise HTTPException(status_code=500, detail="Failed to activate VPN key")
        else:
             raise HTTPException(status_code=500, detail="Database error")

    except InvalidReceiptError as e:
        raise HTTPException(status_code=400, detail=f"Invalid Receipt: {str(e)}")
    except HTTPException as e:
        raise e
    except Exception as e:
        print(f"Verification error: {e}")
        raise HTTPException(status_code=500, detail=str(e))
    finally:
        if os.path.exists(tmp_path):
            os.unlink(tmp_path)

@app.get("/")
async def root():
    return {"message": "MMVPN API is running"}

@app.get("/api/bot/config")
async def get_bot_config():
    from src.bot.config import KBZ_PAY_NUMBER, WAVE_PAY_NUMBER, ADMIN_USERNAME
    return {
        "payment": {
            "kbz": KBZ_PAY_NUMBER,
            "wave": WAVE_PAY_NUMBER,
            "price": "3,000 MMK/month"
        },
        "support": {
            "contact": ADMIN_USERNAME
        },
        "protocols": [
            {"code": "vless", "name": "VLESS Reality (Unlimited)"},
            {"code": "vless_limited", "name": "VLESS Limited (12 Mbps)"},
            {"code": "ss", "name": "Shadowsocks (9388)"},
            {"code": "tuic", "name": "TUIC-Server (2083)"},
            {"code": "vlessplain", "name": "VLESS + TLS (8444)"},
            {"code": "ss_legacy", "name": "Shadowsocks Legacy (8388)"}
        ]
    }

if __name__ == "__main__":
    uvicorn.run(app, host="0.0.0.0", port=API_PORT)

