aW1wb3J0IHNxbGl0ZTMKZnJvbSBmYXN0YXBpIGltcG9ydCBGYXN0QVBJLCBIVFRQRXhjZXB0aW9u
LCBCb2R5LCBVcGxvYWRGaWxlLCBGaWxlLCBGb3JtCmZyb20gcHlkYW50aWMgaW1wb3J0IEJhc2VN
b2RlbAppbXBvcnQgc2h1dGlsCmltcG9ydCB0ZW1wZmlsZQppbXBvcnQgb3MKaW1wb3J0IHV2aWNv
cm4KaW1wb3J0IHV1aWQKZnJvbSBnb29nbGUub2F1dGgyIGltcG9ydCBpZF90b2tlbgpmcm9tIGdv
b2dsZS5hdXRoLnRyYW5zcG9ydCBpbXBvcnQgcmVxdWVzdHMKZnJvbSBzcmMuZGIuZGF0YWJhc2Ug
aW1wb3J0IGdldF91c2VyX2J5X2VtYWlsLCBhZGRfdXNlciwgZ2V0X3VzZXIKCiMgRGF0YWJhc2Ug
c2V0dXAKREJfUEFUSCA9IG9zLmdldGVudigiREJfUEFUSCIsICJzcmMvZGIvdnBuX2JvdC5kYiIp
CkFQSV9QT1JUID0gaW50KG9zLmdldGVudigiQVBJX1BPUlQiLCAiODAwMCIpKQojIENMSUVOVF9J
RCBzaG91bGQgYmUgbG9hZGVkIGZyb20gZW52IG9yIGNvbmZpZywgYnV0IGZvciBub3cgd2UgY2Fu
IGFjY2VwdCBhbnkgdmFsaWQgdG9rZW4gZm9yIHRoaXMgYXBwCiMgSW4gcHJvZHVjdGlvbiwgeW91
IE1VU1QgdmVyaWZ5IHRoZSBhdWQgY2xhaW0gbWF0Y2hlcyB5b3VyIGNsaWVudCBJRC4KR09PR0xF
X0NMSUVOVF9JRCA9IG9zLmdldGVudigiR09PR0xFX0NMSUVOVF9JRCIpIAoKYXBwID0gRmFzdEFQ
SSh0aXRsZT0iTU1WUE4gQVBJIikKCmNsYXNzIFVzZXJTdGF0dXMoQmFzZU1vZGVsKToKICAgIHV1
aWQ6IHN0cgogICAgaXNfYWN0aXZlOiBib29sCiAgICBleHBpcnlfZGF0ZTogc3RyCiAgICBkYXRh
X2xpbWl0X2diOiBmbG9hdAogICAgZGFpbHlfdXNhZ2VfYnl0ZXM6IGludAogICAgcHJvdG9jb2w6
IHN0cgogICAgdXNhZ2VfcGVyY2VudGFnZTogZmxvYXQgPSAwLjAgICMgUGVyY2VudGFnZSBvZiBk
YXRhIHVzZWQgKDAtMTAwKykKICAgIGluX2dyYWNlX3BlcmlvZDogYm9vbCA9IEZhbHNlICAjIFdo
ZXRoZXIgdXNlciBpcyBpbiAyNGggZ3JhY2UgcGVyaW9kCiAgICBncmFjZV9yZW1haW5pbmdfaG91
cnM6IGZsb2F0ID0gMC4wICAjIEhvdXJzIHJlbWFpbmluZyBpbiBncmFjZSBwZXJpb2QKICAgIHdh
cm5pbmdzX3NlbnQ6IGxpc3QgPSBbXSAgIyBMaXN0IG9mIHdhcm5pbmcgdGhyZXNob2xkcyB0cmln
Z2VyZWQgKGUuZy4sIFsnMzAnLCAnNjUnXSkKCmNsYXNzIEdvb2dsZUxvZ2luUmVxdWVzdChCYXNl
TW9kZWwpOgogICAgdG9rZW46IHN0cgoKY2xhc3MgVnBuS2V5KEJhc2VNb2RlbCk6CiAgICB1c2Vy
X3V1aWQ6IHN0cgogICAga2V5X25hbWU6IHN0cgogICAgcHJvdG9jb2w6IHN0cgogICAgc2VydmVy
X2FkZHJlc3M6IHN0cgogICAgc2VydmVyX3BvcnQ6IGludAogICAga2V5X3V1aWQ6IHN0ciA9IE5v
bmUKICAgIGtleV9wYXNzd29yZDogc3RyID0gTm9uZQogICAgY29uZmlnX2xpbms6IHN0cgogICAg
ZXhwaXJlc19hdDogc3RyID0gTm9uZQoKY2xhc3MgVnBuS2V5UmVzcG9uc2UoQmFzZU1vZGVsKToK
ICAgIGlkOiBpbnQKICAgIHVzZXJfdXVpZDogc3RyCiAgICBrZXlfbmFtZTogc3RyCiAgICBwcm90
b2NvbDogc3RyCiAgICBzZXJ2ZXJfYWRkcmVzczogc3RyCiAgICBzZXJ2ZXJfcG9ydDogaW50CiAg
ICBrZXlfdXVpZDogc3RyCiAgICBrZXlfcGFzc3dvcmQ6IHN0cgogICAgY29uZmlnX2xpbms6IHN0
cgogICAgaXNfYWN0aXZlOiBib29sCiAgICBjcmVhdGVkX2F0OiBzdHIKICAgIGV4cGlyZXNfYXQ6
IHN0cgoKZGVmIGdldF9kYl9jb25uZWN0aW9uKCk6CiAgICBjb25uID0gc3FsaXRlMy5jb25uZWN0
KERCX1BBVEgpCiAgICBjb25uLnJvd19mYWN0b3J5ID0gc3FsaXRlMy5Sb3cKICAgIHJldHVybiBj
b25uCgojIFZQTiBLZXlzIEFQSSBlbmRwb2ludHMKQGFwcC5wb3N0KCIvYXBpL2tleXMiKQphc3lu
YyBkZWYgc2F2ZV92cG5fa2V5KGtleTogVnBuS2V5KToKICAgICIiIlNhdmUgYSBWUE4ga2V5IGZv
ciBhIHNwZWNpZmljIHVzZXIiIiIKICAgIGNvbm4gPSBnZXRfZGJfY29ubmVjdGlvbigpCiAgICBj
dXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICB0cnk6CiAgICAgICAgY3Vyc29yLmV4ZWN1dGUoIiIi
CiAgICAgICAgICAgIElOU0VSVCBJTlRPIHZwbl9rZXlzICh1c2VyX3V1aWQsIGtleV9uYW1lLCBw
cm90b2NvbCwgc2VydmVyX2FkZHJlc3MsIHNlcnZlcl9wb3J0LCAKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGtleV91dWlkLCBrZXlfcGFzc3dvcmQsIGNvbmZpZ19saW5rLCBleHBp
cmVzX2F0KQogICAgICAgICAgICBWQUxVRVMgKD8sID8sID8sID8sID8sID8sID8sID8sID8pCiAg
ICAgICAgIiIiLCAoa2V5LnVzZXJfdXVpZCwga2V5LmtleV9uYW1lLCBrZXkucHJvdG9jb2wsIGtl
eS5zZXJ2ZXJfYWRkcmVzcywga2V5LnNlcnZlcl9wb3J0LAogICAgICAgICAgICAgIGtleS5rZXlf
dXVpZCwga2V5LmtleV9wYXNzd29yZCwga2V5LmNvbmZpZ19saW5rLCBrZXkuZXhwaXJlc19hdCkp
CiAgICAgICAgY29ubi5jb21taXQoKQogICAgICAgIHJldHVybiB7InN0YXR1cyI6ICJzdWNjZXNz
IiwgImtleV9pZCI6IGN1cnNvci5sYXN0cm93aWR9CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6
CiAgICAgICAgY29ubi5yb2xsYmFjaygpCiAgICAgICAgcmFpc2UgSFRUUEV4Y2VwdGlvbihzdGF0
dXNfY29kZT01MDAsIGRldGFpbD1mIkZhaWxlZCB0byBzYXZlIGtleToge3N0cihlKX0iKQogICAg
ZmluYWxseToKICAgICAgICBjb25uLmNsb3NlKCkKCkBhcHAuZ2V0KCIvYXBpL2tleXMve3VzZXJf
dXVpZH0iKQphc3luYyBkZWYgZ2V0X3VzZXJfa2V5cyh1c2VyX3V1aWQ6IHN0cik6CiAgICAiIiJH
ZXQgYWxsIFZQTiBrZXlzIGZvciBhIHNwZWNpZmljIHVzZXIiIiIKICAgIGNvbm4gPSBnZXRfZGJf
Y29ubmVjdGlvbigpCiAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICB0cnk6CiAgICAgICAg
Y3Vyc29yLmV4ZWN1dGUoIiIiCiAgICAgICAgICAgIFNFTEVDVCBpZCwgdXNlcl91dWlkLCBrZXlf
bmFtZSwgcHJvdG9jb2wsIHNlcnZlcl9hZGRyZXNzLCBzZXJ2ZXJfcG9ydCwKICAgICAgICAgICAg
ICAgICAgIGtleV91dWlkLCBrZXlfcGFzc3dvcmQsIGNvbmZpZ19saW5rLCBpc19hY3RpdmUsIAog
ICAgICAgICAgICAgICAgICAgY3JlYXRlZF9hdCwgZXhwaXJlc19hdAogICAgICAgICAgICBGUk9N
IHZwbl9rZXlzIAogICAgICAgICAgICBXSEVSRSB1c2VyX3V1aWQgPSA/IEFORCBpc19hY3RpdmUg
PSAxCiAgICAgICAgICAgIE9SREVSIEJZIGNyZWF0ZWRfYXQgREVTQwogICAgICAgICIiIiwgKHVz
ZXJfdXVpZCwpKQogICAgICAgIGtleXMgPSBjdXJzb3IuZmV0Y2hhbGwoKQogICAgICAgIHJldHVy
biB7ImtleXMiOiBbZGljdChrKSBmb3IgayBpbiBrZXlzXX0KICAgIGZpbmFsbHk6CiAgICAgICAg
Y29ubi5jbG9zZSgpCgpAYXBwLmRlbGV0ZSgiL2FwaS9rZXlzL3trZXlfaWR9IikKYXN5bmMgZGVm
IGRlbGV0ZV92cG5fa2V5KGtleV9pZDogaW50LCB1c2VyX3V1aWQ6IHN0cik6CiAgICAiIiJEZWxl
dGUgYSBWUE4ga2V5IChzb2Z0IGRlbGV0ZSBieSBzZXR0aW5nIGlzX2FjdGl2ZT0wKSIiIgogICAg
Y29ubiA9IGdldF9kYl9jb25uZWN0aW9uKCkKICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAg
IHRyeToKICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiIiIKICAgICAgICAgICAgVVBEQVRFIHZwbl9r
ZXlzIFNFVCBpc19hY3RpdmUgPSAwIAogICAgICAgICAgICBXSEVSRSBpZCA9ID8gQU5EIHVzZXJf
dXVpZCA9ID8KICAgICAgICAiIiIsIChrZXlfaWQsIHVzZXJfdXVpZCkpCiAgICAgICAgY29ubi5j
b21taXQoKQogICAgICAgIGlmIGN1cnNvci5yb3djb3VudCA9PSAwOgogICAgICAgICAgICByYWlz
ZSBIVFRQRXhjZXB0aW9uKHN0YXR1c19jb2RlPTQwNCwgZGV0YWlsPSJLZXkgbm90IGZvdW5kIG9y
IG5vdCBhdXRob3JpemVkIikKICAgICAgICByZXR1cm4geyJzdGF0dXMiOiAiZGVsZXRlZCJ9CiAg
ICBmaW5hbGx5OgogICAgICAgIGNvbm4uY2xvc2UoKQoKCkBhcHAucG9zdCgiL2FwaS9hdXRoL2dv
b2dsZSIpCmFzeW5jIGRlZiBnb29nbGVfbG9naW4ocmVxdWVzdDogR29vZ2xlTG9naW5SZXF1ZXN0
KToKICAgIHRyeToKICAgICAgICAjIFZlcmlmeSB0aGUgdG9rZW4KICAgICAgICBpZF9pbmZvID0g
aWRfdG9rZW4udmVyaWZ5X29hdXRoMl90b2tlbigKICAgICAgICAgICAgcmVxdWVzdC50b2tlbiwg
CiAgICAgICAgICAgIHJlcXVlc3RzLlJlcXVlc3QoKSwgCiAgICAgICAgICAgIEdPT0dMRV9DTElF
TlRfSUQsCiAgICAgICAgICAgIGNsb2NrX3NrZXdfaW5fc2Vjb25kcz02MAogICAgICAgICkKICAg
ICAgICBlbWFpbCA9IGlkX2luZm8uZ2V0KCdlbWFpbCcpCiAgICAgICAgaWYgbm90IGVtYWlsOgog
ICAgICAgICAgICByYWlzZSBIVFRQRXhjZXB0aW9uKHN0YXR1c19jb2RlPTQwMCwgZGV0YWlsPSJU
b2tlbiBkb2VzIG5vdCBjb250YWluIGVtYWlsIikKICAgICAgICAgICAgCiAgICAgICAgIyBDaGVj
ayBpZiB1c2VyIGV4aXN0cwogICAgICAgIHVzZXIgPSBnZXRfdXNlcl9ieV9lbWFpbChlbWFpbCkK
ICAgICAgICAKICAgICAgICBpZiB1c2VyOgogICAgICAgICAgICB1c2VyX3V1aWQgPSB1c2VyWyd1
dWlkJ10KICAgICAgICBlbHNlOgogICAgICAgICAgICAjIENyZWF0ZSBuZXcgdXNlcgogICAgICAg
ICAgICB1c2VyX3V1aWQgPSBzdHIodXVpZC51dWlkNCgpKQogICAgICAgICAgICAjIERlZmF1bHQg
dmFsdWVzIGZvciBuZXcgdXNlcnMKICAgICAgICAgICAgc3VjY2VzcyA9IGFkZF91c2VyKAogICAg
ICAgICAgICAgICAgdXVpZD11c2VyX3V1aWQsCiAgICAgICAgICAgICAgICB0ZWxlZ3JhbV9pZD0w
LCAjIE5vIHRlbGVncmFtIElEIGZvciBHb29nbGUgdXNlcnMgaW5pdGlhbGx5CiAgICAgICAgICAg
ICAgICB1c2VybmFtZT1lbWFpbC5zcGxpdCgnQCcpWzBdLAogICAgICAgICAgICAgICAgZW1haWw9
ZW1haWwsCiAgICAgICAgICAgICAgICBwcm90b2NvbD0ndmxlc3MnLCAjIERlZmF1bHQgdG8gVkxF
U1MgZm9yIGFwcCB1c2VycwogICAgICAgICAgICAgICAgZXhwaXJ5X2RheXM9MzAsCiAgICAgICAg
ICAgICAgICBpc19wcmVtaXVtPUZhbHNlCiAgICAgICAgICAgICkKICAgICAgICAgICAgaWYgbm90
IHN1Y2Nlc3M6CiAgICAgICAgICAgICAgICByYWlzZSBIVFRQRXhjZXB0aW9uKHN0YXR1c19jb2Rl
PTUwMCwgZGV0YWlsPSJGYWlsZWQgdG8gY3JlYXRlIHVzZXIiKQoKICAgICAgICByZXR1cm4geyJ1
dWlkIjogdXNlcl91dWlkLCAiZW1haWwiOiBlbWFpbH0KCiAgICBleGNlcHQgVmFsdWVFcnJvciBh
cyBlOgogICAgICAgIHByaW50KGYiVG9rZW4gdmVyaWZpY2F0aW9uIGZhaWxlZDoge2V9IikKICAg
ICAgICByYWlzZSBIVFRQRXhjZXB0aW9uKHN0YXR1c19jb2RlPTQwMSwgZGV0YWlsPWYiSW52YWxp
ZCB0b2tlbjoge3N0cihlKX0iKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHBy
aW50KGYiU2VydmVyIGVycm9yOiB7ZX0iKQogICAgICAgIHJhaXNlIEhUVFBFeGNlcHRpb24oc3Rh
dHVzX2NvZGU9NTAwLCBkZXRhaWw9ZiJJbnRlcm5hbCBzZXJ2ZXIgZXJyb3I6IHtzdHIoZSl9IikK
CkBhcHAuZ2V0KCIvYXBpL3N0YXR1cy97dXVpZH0iLCByZXNwb25zZV9tb2RlbD1Vc2VyU3RhdHVz
KQphc3luYyBkZWYgZ2V0X3VzZXJfc3RhdHVzKHV1aWQ6IHN0cik6CiAgICBjb25uID0gZ2V0X2Ri
X2Nvbm5lY3Rpb24oKQogICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgCiAgICAjIFF1ZXJ5
IGZvciB0aGUgdXNlcgogICAgY3Vyc29yLmV4ZWN1dGUoIlNFTEVDVCAqIEZST00gdXNlcnMgV0hF
UkUgdXVpZCA9ID8iLCAodXVpZCwpKQogICAgdXNlciA9IGN1cnNvci5mZXRjaG9uZSgpCiAgICAK
ICAgICMgUXVlcnkgZm9yIGRhaWx5IHVzYWdlCiAgICBmcm9tIGRhdGV0aW1lIGltcG9ydCBkYXRl
dGltZQogICAgdG9kYXkgPSBkYXRldGltZS5ub3coKS5kYXRlKCkuaXNvZm9ybWF0KCkKI