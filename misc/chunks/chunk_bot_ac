er_stats(user.id)
    key_index = len(current_stats) + 1
    
    # Sanitize name for tag (remove special chars) with proper fallback
    raw_name = user.username or user.first_name or f"User{user.id}"
    safe_name = "".join(c for c in raw_name if c.isalnum())
    if not safe_name: safe_name = "User"
    key_tag = f"{safe_name}-Key{key_index}"
    
    # Get user's protocol choice (default to SS if not set) - MUST be before add_user!
    protocol = context.user_data.get('protocol', 'ss')
    
    # Ensure username is never None (use fallback for DB storage)
    db_username = user.username or user.first_name or f"User{user.id}"
    
    # Add to DB
    if add_user(user_uuid, user.id, db_username, protocol, user.language_code, user.is_premium):
        # Update Sing-Box config based on protocol
        try:
            if protocol == 'vless' or protocol == 'vless_limited':
                from bot.config_manager import add_user_to_config
                from db.database import get_db_connection
                
                # Determine limit based on protocol
                limit_mbps = 0
                if protocol == 'vless_limited':
                    limit_mbps = 12.0
                
                # Update DB with limit (since add_user uses default)
                conn = get_db_connection()
                c = conn.cursor()
                c.execute("UPDATE users SET speed_limit_mbps = ? WHERE uuid = ?", (limit_mbps, user_uuid))
                conn.commit()
                conn.close()
                
                add_user_to_config(user_uuid, key_tag, limit_mbps)
            elif protocol == 'tuic':
                from bot.config_manager import add_tuic_user
                add_tuic_user(user_uuid, key_tag)
            elif protocol == 'vlessplain':
                from bot.config_manager import add_vless_plain_user
                add_vless_plain_user(user_uuid, key_tag)
            elif protocol == 'ss':
                from bot.config_manager import add_ss_user
                add_ss_user(user_uuid, key_tag)
            elif protocol == 'admin_tuic':
                from bot.config_manager import add_admin_tuic_user
                add_admin_tuic_user(user_uuid, key_tag)
            # SS Legacy uses shared password, no config update needed
        except Exception as e:
            logger.error(f"Failed to update config for {protocol}: {e}")
            await update.message.reply_text("Account created but VPN activation failed. Contact support.")
            return

        # Generate link based on protocol
        # Generate link based on protocol
        if protocol == 'ss':
            # Generate Shadowsocks link with unique password (UUID)
            import base64
            ss_credential = f"{SS_METHOD}:{user_uuid}"
            ss_encoded = base64.b64encode(ss_credential.encode()).decode()
            vpn_link = f"ss://{ss_encoded}@{SS_SERVER}:{SS_PORT}#{key_tag}"
            protocol_name = "Shadowsocks"
            
        elif protocol == 'tuic':
            # Generate TUIC Link (must use cert's CN for SNI)
            vpn_link = f"tuic://{user_uuid}:{user_uuid}@{SERVER_IP}:{TUIC_PORT}?congestion_control=bbr&alpn=h3&sni=www.microsoft.com&allow_insecure=1#{key_tag}"
            protocol_name = "TUIC"
            
        elif protocol == 'vlessplain':
            # Generate Plain VLESS Link (VLESS over TCP/TLS, must use cert's CN for SNI)
            vpn_link = f"vless://{user_uuid}@{SERVER_IP}:{VLESS_PLAIN_PORT}?security=tls&encryption=none&type=tcp&sni=www.microsoft.com&allowInsecure=1#{key_tag}"
            protocol_name = "Plain VLESS"
            
        elif protocol == 'ss_legacy':
            # Generate Legacy Shadowsocks Link (Shared Password)
            import base64
            ss_credential = f"{SS_METHOD}:{SS_LEGACY_PASSWORD}"
            ss_encoded = base64.b64encode(ss_credential.encode()).decode()
            vpn_link = f"ss://{ss_encoded}@{SS_SERVER}:{SS_LEGACY_PORT}#{key_tag}"
            protocol_name = "Shadowsocks (Standalone)"
            
        else:  # Default to VLESS+REALITY
            # Generate VLESS+REALITY Link
            vpn_link = f"vless://{user_uuid}@{SERVER_IP}:{SERVER_PORT}?security=reality&encryption=none&pbk={PUBLIC_KEY}&fp=randomized&type=tcp&flow=xtls-rprx-vision&sni={SERVER_NAME}&sid={SHORT_ID}#{key_tag}"
            protocol_name = "VLESS+REALITY"
        
        # Generate QR Code
        qr = qrcode.QRCode(version=1, box_size=10, border=5)
        qr.add_data(vpn_link)
        qr.make(fit=True)
        img = qr.make_image(fill_color="black", back_color="white")
        
        bio = io.BytesIO()
        img.save(bio)
        bio.seek(0)
        
        # Create Deep Link
        import urllib.parse
        encoded_link = urllib.parse.quote(vpn_link)
        deep_link = f"mmvpn://import?url={encoded_link}"
        
        keyboard = [[InlineKeyboardButton("🚀 Import to mmvpn", url=deep_link)]]
        reply_markup = InlineKeyboardMarkup(keyboard)
        
        await update.message.reply_text(
            f"[Key] Your {protocol_name} key is ready!\n\n"
            f"[Link] Copy link:\n`{vpn_link}`\n\n"
            f"[🚀 Import to MMVPN App]({deep_link})\n\n"
            f"[Tip] Only use on 1 device!",
            parse_mode="Markdown"
        )
        await update.message.reply_photo(bio, caption="Scan this QR to import", reply_markup=reply_markup)
        
    else:
        await update.message.reply_text("[X] Error generating key. Please contact support.")

async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """Send a message when the command /help is issued."""
    # Check if called from callback or command
    if update.callback_query:
        message_func = update.callback_query.message.reply_text
    else:
        message_func = update.message.reply_text
        
    await message_func(f"Need help? Contact {ADMIN_USERNAME} for support!")

async def handle_