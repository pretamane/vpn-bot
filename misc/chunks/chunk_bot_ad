status(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """Handle /status command to show user stats."""
    user = update.effective_user
    stats = get_user_stats(user.id)
    
    # Check if called from callback or command
    if update.callback_query:
        message_func = update.callback_query.message.reply_text
    else:
        message_func = update.message.reply_text

    if not stats:
        await message_func("You don't have any VPN keys yet. Use /buy to get one!")
        return
        
    # Header for the first message
    header = "[Status] *Your VPN Status*\n\n"
    
    current_msg = header
    MAX_LENGTH = 4000  # Leave some buffer
    
    for i, s in enumerate(stats, 1):
        status_icon = "✅" if s['is_active'] else "❌"
        usage_gb = s['daily_usage_bytes'] / (1024**3)
        limit_gb = s['data_limit_gb']
        protocol = s.get('protocol', 'ss')
        uuid = s['uuid']
        
        # Generate key tag
        raw_name = user.username or user.first_name or f"User{user.id}"
        safe_name = "".join(c for c in raw_name if c.isalnum())
        if not safe_name: safe_name = "User"
        key_tag = f"{safe_name}-Key{i}"

        # Generate protocol-specific key
        # Generate protocol-specific key
        if protocol == 'vless':
            # Generate VLESS+REALITY Link
            vpn_link = f"vless://{uuid}@{SERVER_IP}:{SERVER_PORT}?security=reality&encryption=none&pbk={PUBLIC_KEY}&fp=randomized&type=tcp&flow=xtls-rprx-vision&sni={SERVER_NAME}&sid={SHORT_ID}#{key_tag}"
            protocol_name = "VLESS+REALITY"
            
        elif protocol == 'tuic':
            # Generate TUIC Link
            vpn_link = f"tuic://{uuid}:{uuid}@{SERVER_IP}:{TUIC_PORT}?congestion_control=bbr&alpn=h3&sni=www.microsoft.com&allow_insecure=1#{key_tag}"
            protocol_name = "TUIC-Server"
            
        elif protocol == 'vlessplain':
            # Generate Plain VLESS Link
            vpn_link = f"vless://{uuid}@{SERVER_IP}:{VLESS_PLAIN_PORT}?security=tls&encryption=none&type=tcp&sni=www.microsoft.com&allowInsecure=1#{key_tag}"
            protocol_name = "VLESS + TLS"
            
        elif protocol == 'ss_legacy':
            # Generate Legacy Shadowsocks Link
            import base64
            ss_credential = f"{SS_METHOD}:{SS_LEGACY_PASSWORD}"
            ss_encoded = base64.b64encode(ss_credential.encode()).decode()
            vpn_link = f"ss://{ss_encoded}@{SS_SERVER}:{SS_LEGACY_PORT}#{key_tag}"
            protocol_name = "Shadowsocks (Legacy)"
            
        elif protocol == 'admin_tuic':
            # Generate Admin TUIC Link
            vpn_link = f"tuic://{uuid}:{uuid}@{SERVER_IP}:8443?congestion_control=bbr&alpn=h3&sni=www.microsoft.com&allow_insecure=1#{key_tag}"
            protocol_name = "Admin TUIC"
            
        else:
            # Default to Shadowsocks (Standard)
            import base64
            ss_credential = f"{SS_METHOD}:{uuid}"
            ss_encoded = base64.b64encode(ss_credential.encode()).decode()
            vpn_link = f"ss://{ss_encoded}@{SS_SERVER}:{SS_PORT}#{key_tag}"
            protocol_name = "Shadowsocks"
        
        # Build key info block
        key_block = ""
        status_text = 'Active' if s['is_active'] else 'Inactive/Banned'
        key_block += f"*[Key {i}]* {protocol_name} {status_icon}\n"
        key_block += f"Status: {status_text}\n"
        key_block += f"Usage: `{usage_gb:.2f} GB` / `{limit_gb} GB`\n"
        key_block += f"Expires: {s['expiry_date'][:10]}\n\n"
        # Create Deep Link
        import urllib.parse
        encoded_link = urllib.parse.quote(vpn_link)
        deep_link = f"mmvpn://import?url={encoded_link}"

        key_block += f"*Your VPN Link:*\n`{vpn_link}`\n"
        key_block += f"[🚀 Import to mmvpn]({deep_link})\n\n"
        key_block += "━━━━━━━━━━━━━━━\n\n"
        
        # Check if adding this block would exceed limit
        if len(current_msg) + len(key_block) > MAX_LENGTH:
            # Send current chunk
            await message_func(current_msg, parse_mode='Markdown')
            # Start new chunk
            current_msg = key_block
        else:
            current_msg += key_block
            
    # Add footer to the last message
    current_msg += "_💡 Tip: Copy the link above to import into your VPN app_"
        
    # Send the final (or only) chunk
    if current_msg:
        await message_func(current_msg, parse_mode='Markdown')

async def handle_menu_callback(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """Handle main menu button clicks."""
    query = update.callback_query
    await query.answer()
    
    action = query.data.split("_")[1]
    
    if action == "buy":
        # Call buy logic directly
        await buy(update, context)
    elif action == "status":
        # Call status logic directly
        await handle_status(update, context)
    elif action == "help":
        # Call help logic directly
        await help_command(update, context)

async def admin_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """Admin dashboard entry point."""
    # Ask for password
    await update.message.reply_text(
        "🔒 *Admin Access*\n\nPlease enter the admin password to continue:",
        parse_mode="Markdown"
    )
    # Set state to waiting for password
    context.user_data['waiting_for_admin_pass'] = True

async def show_admin_dashboard(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """Show the actual dashboard."""
    keyboard = [
        [InlineKeyboardButton("👥 List Users", callback_data="admin_list_users")],
        [InlineKeyboardButton("📊 System Stats", callback_data="admin_stats")],
        [InlineKeyboardButton("❌ Close", callback_data="admin_close")]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    # Check if called from callback or message
    if update.callback_query:
      