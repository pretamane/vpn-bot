=h3&sni=www.microsoft.com&allow_insecure=1#{key_tag}"
            
            # Add to database (skip sing-box config as this uses legacy tuic-server)
            from db.database import add_user
            if add_user(user_uuid, user.id, user.username or user.first_name or f"User{user.id}", 
                       'admin_tuic', user.language_code, user.is_premium):
                
                # Update Server Config
                from bot.config_manager import add_admin_tuic_user
                add_admin_tuic_user(user_uuid, key_tag)
                
                # Generate QR Code
                import qrcode
                import io
                qr = qrcode.QRCode(version=1, box_size=10, border=5)
                qr.add_data(vpn_link)
                qr.make(fit=True)
                img = qr.make_image(fill_color="black", back_color="white")
                
                bio = io.BytesIO()
                img.save(bio)
                bio.seek(0)
                
                await update.message.reply_text(
                    f"✅ **Admin TUIC Key Generated!**\n\n"
                    f"🔐 **Thailand's Dedicated India Server**\n"
                    f"[Link] Copy link:\n`{vpn_link}`\n\n"
                    f"[Tip] For personal use only!",
                    parse_mode="Markdown"
                )
                await update.message.reply_photo(bio, caption="Scan this QR to import")
            else:
                await update.message.reply_text("❌ Error generating key. Contact support.")
        else:
            # Wrong password
            await update.message.reply_text(
                "❌ **Incorrect Password**\n\n"
                "Access denied. This feature is admin-only.",
                parse_mode="Markdown"
            )
            context.user_data['awaiting_admin_password'] = False
        
        return
    
    # Handle other text messages (if any)
    await update.message.reply_text("Please use the /start command to see available options.")

async def handle_photo(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """Handle payment screenshot."""
    user = update.effective_user
    photo_file = await update.message.photo[-1].get_file()
    
    # Download image temporarily
    with tempfile.NamedTemporaryFile(delete=False, suffix='.jpg') as tmp:
        await photo_file.download_to_drive(tmp.name)
        tmp_path = tmp.name
        
    try:
        # 1. NSFW Detection
        detector = get_nsfw_detector()
        if detector:
            try:
                predictions = detector.detect(tmp_path)
                nsfw_classes = ['EXPOSED_GENITALIA', 'EXPOSED_BREAST_F', 'EXPOSED_BUTTOCKS', 'EXPOSED_ANUS']
                is_nsfw = any(
                    pred['class'] in nsfw_classes and pred['score'] > 0.6
                    for pred in predictions
                )
                if is_nsfw:
                    await update.message.reply_text("Inappropriate content detected.", parse_mode="Markdown")
                    return
            except Exception as e:
                logger.error(f"NSFW detection failed: {e}")

        # 2. OCR & Payment Validation
        await update.message.reply_text("Verifying payment slip... (this may take a few seconds)")
        
        from services.ocr_service import ocr_service
        from services.payment_validator import payment_validator, InvalidReceiptError
        from db.database import is_transaction_used, add_transaction
        
        # Extract text
        text_lines = ocr_service.extract_text(tmp_path)
        
        if not text_lines:
            await update.message.reply_text("Could not read text from image. Please send a clear screenshot.")
            return
            
        # Validate receipt
        try:
            data = payment_validator.validate_receipt(text_lines)
            
            TEST_SLIP_ID = "01003984021770423212"
            
            if data['transaction_id'] == TEST_SLIP_ID:
                await update.message.reply_text(
                    f"The Test Banking Slip is being utilized.\n"
                    f"Transaction ID: {data['transaction_id']}\n"
                    f"User: {user.username or user.first_name}"
                )
            else:
                # Check for duplicates
                if is_transaction_used(data['transaction_id']):
                    await update.message.reply_text(f"Transaction ID `{data['transaction_id']}` has already been used!", parse_mode="Markdown")
                    return
                    
                # Check amount (allow small margin of error or exact match)
                if data['amount'] < 3000:
                    await update.message.reply_text(f"Amount `{data['amount']}` is less than required 3,000 MMK.", parse_mode="Markdown")
                    return
                    
                # Success! Record transaction
                add_transaction(user.id, data['provider'], data['transaction_id'], data['amount'])
                await update.message.reply_text(f"Payment Verified!\nProvider: {data['provider']}\nTID: `{data['transaction_id']}`", parse_mode="Markdown")
            
        except InvalidReceiptError as e:
            await update.message.reply_text(f"Invalid Receipt: {str(e)}\n\nPlease make sure to upload a valid KBZ Pay or Wave Pay slip.")
            return
        except Exception as e:
            logger.error(f"Validation error: {e}")
            await update.message.reply_text("Error verifying receipt. Please contact support.")
            return

    finally:
        # Clean up temp file
        if os.path.exists(tmp_path):
            os.unlink(tmp_path)
    
    # Key limit removed - users can buy as many keys as they want with valid payments
    # Each payment must be unique (no duplicate transaction IDs)
    
    # Generate UUID
    user_uuid = str(uuid.uuid4())
    
    # Calculate key index for tagging
    current_stats = get_us